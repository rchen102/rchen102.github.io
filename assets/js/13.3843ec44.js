(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{432:function(s,a,t){"use strict";t.r(a);var n=t(25),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"事务的四大特征"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#事务的四大特征"}},[s._v("#")]),s._v(" 事务的四大特征")]),s._v(" "),t("p",[t("strong",[s._v("事务（Transaction）是以可控的方式对数据资源进行访问的一组操作")])]),s._v(" "),t("ol",[t("li",[s._v("原子性（Atomicity）：原子性要求事务所包含的全部操作是一个不可分割的整体，这些操作要么全部提交成功，要么只要其中一个操作失败，就全部失败")]),s._v(" "),t("li",[s._v("一致性（Consistency）：若数据资源在事务执行之前处于某个数据一致性状态（如两个账户金额总和为 1000），一致性要求事务执行后依然保持数据间的一致性状态（A 向 B 转账 500，总和依然为 1000）")]),s._v(" "),t("li",[s._v("隔离性（Isolation）：事务的隔离性主要规定了各个事务之间相互影响的程度，隔离性的概念主要面向数据的并发访问（Concurrency）")]),s._v(" "),t("li",[s._v("持久性（Durability）：当事务提交或者回滚后，数据库会持久化的更新保存数据")])]),s._v(" "),t("h2",{attrs:{id:"事务的四大隔离级别"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#事务的四大隔离级别"}},[s._v("#")]),s._v(" 事务的四大隔离级别")]),s._v(" "),t("p",[t("strong",[s._v("并发访问可能产生的问题")])]),s._v(" "),t("ul",[t("li",[t("p",[s._v("脏读（Dirty Read）：一个事务读取到另一个事务中没有提交的数据。如果事务 1 读取到事务 2 还未提交的数据，事务 2 回滚，则事务 1 读取到的数据就是一笔脏数据")])]),s._v(" "),t("li",[t("p",[s._v("不可重复读（Non-Repeatable Read）：也叫虚读，指的是同一个事务在整个事务过程中，对同一笔数据进行读取，每次读取的结果都不同。如事务 1 在事务 2 的更新操作执行前读取一次，在事务 2 更新操作后再读取同一笔数据一次，两次结果不同")])]),s._v(" "),t("li",[t("p",[s._v("幻读（Phantom Read）：指的是同样一个查询，在整个事务过程中多次执行后，查询所得的结果集是不一样的。幻读针对的是多笔记录")])])]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("幻读和不可重复读区别")]),s._v(" "),t("p",[s._v("幻读是读到之前没有出现过的数据（新增或删除），不可重复读是同一条数据多次读结果不同")])]),s._v(" "),t("hr"),s._v(" "),t("p",[t("strong",[s._v("隔离级别")])]),s._v(" "),t("ul",[t("li",[t("p",[t("code",[s._v("Read Uncommitted")]),s._v(" ："),t("em",[s._v("无法解决脏读、不可重复读、幻读")]),t("br"),s._v("\n最低的隔离级别，一个事务可以读取另一个事务还未提交的更新结果，以较低隔离度来寻求较高的性能")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("Read Committed")]),s._v(" ："),t("em",[s._v("可以避免脏读，无法解决不可重复读、幻读")]),t("br"),s._v("\n大部分数据库采用的默认隔离级别，一个事务的更新结果只有在事务提交后，另一个事务才可能读取到")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("Repeatable Read")]),s._v(" ："),t("em",[s._v("可以避免脏读、不可重复读，无法解决幻读")]),t("br"),s._v("\n该隔离级别可以保证在整个事务的过程中，对同一笔数据的读取结果是相同的，不管其他事务是否同时在对同一笔数据进行更新，也不管其他事务对同一笔数据的更新提交与否")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("Serializable")]),s._v(" ："),t("em",[s._v("可以避免全部问题")]),t("br"),s._v("\n最为严格的隔离级别，所有事务操作都必须依次顺序进行，是最安全的隔离级别，但同时也是性能最差的隔离级别。因为该隔离级别极大影响系统性能，所以很少使用，通常情况下，会采用其他隔离级别加上相应的并发锁机制来控制对数据的访问")])])]),s._v(" "),t("h2",{attrs:{id:"基本操作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#基本操作"}},[s._v("#")]),s._v(" 基本操作")]),s._v(" "),t("div",{staticClass:"language-sql line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sql"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- MySQL数据库中事务默认自动提交，一条DML(增删改)语句会自动提交一次事务(Oracle默认手动)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 手动开启事务后，如果语句执行完毕后没有提交，则程序终止时会自动回滚")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以修改事务的默认提交方式")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" @"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@autocommit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 1: 自动提交 0: 手动提交")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" @"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@autocommit")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 1. 开启事务")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("START")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TRANSACTION")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# A 向 B 转账50")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UPDATE")]),s._v(" account "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" balance "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" balance "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" name "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'A'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("UPDATE")]),s._v(" account "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" balance "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" balance "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("WHERE")]),s._v(" name "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'B'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 2. 如果以上两条语句执行完毕后发现出现错误，则回滚")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ROLLBACK")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 3. 如果没有问题。正确执行，则提交事务")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COMMIT")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 数据库设置隔离级别")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查询隔离级别")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SELECT")]),s._v(" @"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@tx_isolation")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 默认 REPEATABLE READ")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置隔离级别")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SET")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GLOBAL")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TRANSACTION")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ISOLATION")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("LEVEL")]),s._v(" 级别字符串"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 重新连接数据后生效")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br")])])])}),[],!1,null,null,null);a.default=e.exports}}]);