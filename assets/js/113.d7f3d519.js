(window.webpackJsonp=window.webpackJsonp||[]).push([[113],{373:function(t,a,_){"use strict";_.r(a);var s=_(25),r=Object(s.a)({},(function(){var t=this,a=t.$createElement,_=t._self._c||a;return _("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[_("h3",{attrs:{id:"tcp-四次挥手"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#tcp-四次挥手"}},[t._v("#")]),t._v(" TCP 四次挥手")]),t._v(" "),_("p",[_("img",{attrs:{src:"/img/Network/TCP4.png",alt:"四次挥手"}}),t._v("\nTCP 采用四次挥手来释放连接")]),t._v(" "),_("ul",[_("li",[t._v("第一次挥手：客户端发送一个 FIN，用来关闭客户端到服务器的数据传送，客户端进入到 FIN_WAIT_1 状态")]),t._v(" "),_("li",[t._v("第二次挥手：服务器收到 FIN 后，发送一个 ACK 给客户端，确认序号为收到序号加一（与 SYN 相同，一个 FIN 占用一个序号），服务器进入 CLOSE_WAIT 状态")]),t._v(" "),_("li",[t._v("第三次挥手：服务器发送一个 FIN ，用来关闭服务器到客户端的数据传送，服务器进入 LAST_ACK 状态")]),t._v(" "),_("li",[t._v("第四次挥手：客户端收到 FIN 后，客户端进入 TIME_WAIT 状态，接着发送一个 ACK 给服务器，确认序号为收到序号加一，服务器收到后，立刻进入到 CLOSED 状态，完成四次挥手，客户端还需等待一定时间（2 MSL）才会最终进入 CLOSED 状态")])]),t._v(" "),_("h3",{attrs:{id:"为什么会有-time-wait-状态"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#为什么会有-time-wait-状态"}},[t._v("#")]),t._v(" 为什么会有 TIME_WAIT 状态")]),t._v(" "),_("ul",[_("li",[t._v("确保有足够的时间，让对方收到 ACK 包；否则会触发对方（被动关闭方）重发 FIN 包，一去一回时间正好是 2 MSL")]),t._v(" "),_("li",[t._v("避免新旧连接混淆")])]),t._v(" "),_("h3",{attrs:{id:"为什么需要四次挥手才能断开连接"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#为什么需要四次挥手才能断开连接"}},[t._v("#")]),t._v(" 为什么需要四次挥手才能断开连接")]),t._v(" "),_("p",[t._v("因为 TCP 连接是全双工的，因此发送方和接收方都需要 FIN 报文和 ACK 报文，即发送方和接收方各自需要两次挥手即可，只不过因为一方处于被动的，所有看上去就成了四次挥手")]),t._v(" "),_("h3",{attrs:{id:"服务器出现大量-close-wait-状态的原因"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#服务器出现大量-close-wait-状态的原因"}},[t._v("#")]),t._v(" 服务器出现大量 CLOSE_WAIT 状态的原因")]),t._v(" "),_("p",[t._v("服务器接收到 FIN 后，没有及时发送 FIN 报文；即对方关闭 socket 连接，我方忙于读或写，没有及时关闭连接")]),t._v(" "),_("ul",[_("li",[t._v("检查代码，特别是释放连接资源的代码")]),t._v(" "),_("li",[t._v("检查配置，特别是处理请求的线程配置")])])])}),[],!1,null,null,null);a.default=r.exports}}]);